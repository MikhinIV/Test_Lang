<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Page Title</title>
<!--    <script src="init.txt"></script>-->
<!--  <link rel="stylesheet" href="vendor/css/bootstrap.min.css">  -->
  <link rel="stylesheet" type="text/css" href="/static/twoLetter.css">
</head>
<body>
        <h1 id="tema"></h1>
        <h2 id = "info"></h2>
        <div class="words" id="blockwords" > </div>
        <button type="button" class="button last"  onclick="onClick()"  id = "btnFinish">Проверить</button>
    
    <script>
        var tema = `Приставки пре- и при-`;
        //Задание
        var task = `Вставьте пропущенные буквы в слово`;
        //Количество слов в тесте
        var countword = 7;
        //Буква 1
        var name1 = `е`;
        //Буква 2
        var name2 = `и`;

        //Слова 
        var words = `пребольшой, преувеличить, преступать, превращать, преображать, приморский, приделать, пригибать, приоткрыть, придумать, припевать, прибаутка, прибывать, приоритет, препираться, преграда,препятствие, претензия, причудливый`;
                
        //Номера букв
        var place = [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3];

        var arr1 = [], arr2= [];
        var arr_word = [], arr_num = [];

        function checkwords() {
            let sum = 0;
            let panelList = document.getElementsByClassName("Panel");
            for (let i = 0; i < panelList.length; i++) {
               if (panelList[i].lastChild.innerHTML.replace(/<[^>]+>/g,'') == arr_word[i+1]) {
                   sum++;
                   panelList[i].lastChild.className = "right";
               } else {panelList[i].lastChild.className = "wrong";}
            }
            return sum;
        }
        
        function checktest() {
            let buttonsList = document.getElementsByClassName("letter");
            for (let i = 0; i < buttonsList.length; i++) {
                buttonsList[i].className = "button letter hide";
            }
            var countOk = checkwords();
            document.getElementById("info").innerHTML = 'Правильных ответов - ' + countOk;
        }
        
        function onClick(){
            let lastButton = document.getElementById("btnFinish");
            if (lastButton.innerHTML == "Проверить") {
                checktest();
                lastButton.innerHTML = "Старт";
            } else {
                generatewords();
                lastButton.innerText = "Проверить";
            }
        }
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min)) + min; //Максимум не включается, минимум включается
        }
        
        function init() {
            document.getElementById("tema").innerHTML = tema;
        }
        function clearWords(elem) {
            while (elem.firstElementChild) { elem.removeChild(elem.firstElementChild); }
        }
        function clickB(e) {
           document.getElementById('str' + e.target.id).innerHTML = arr_word[e.target.id].slice(0, arr_num[e.target.id]-1) + '<b>' + e.target.innerHTML + '</b>' + arr_word[e.target.id].slice(arr_num[e.target.id]);
        }
        
        function createPanel(text, num, i){
            var newPanel = document.createElement("div");
            arr_word.push(text);
            arr_num.push(num);
            newPanel.className = "Panel";
            newPanel.id = i.toString();

            var newBlock = document.createElement("div");
            newBlock.className = "buttonBlock"
            newPanel.appendChild(newBlock);
            
            newDiv = document.createElement("button");
            newDiv.className = "button letter";
            newDiv.innerHTML = name1;
            newDiv.onclick = clickB;
            newDiv.id = i.toString();
            newBlock.appendChild(newDiv);
            
            newDiv = document.createElement("button");
            newDiv.className = "button letter";
            newDiv.innerHTML = name2;
            newDiv.onclick = clickB;
            newDiv.id = i.toString();
            newBlock.appendChild(newDiv);
            
            newDiv = document.createElement("p");
            newDiv.innerHTML = text.slice(0, num-1) + '...' + text.slice(num);
            newDiv.style.width = 90 + '%';
            newDiv.style.margin = 0;
            newDiv.id = 'str' + i.toString();
            newPanel.appendChild(newDiv);
            document.getElementById("blockwords").appendChild(newPanel);
        }
        
        function generatewords() {
            arr1 = words.split(',');
            arr2 = place.slice();
            arr_word.splice(0, arr_word.length);
            arr_num.splice(0, arr_num.length);
            
            arr_word.push('');
            arr_num.push(0);
            document.getElementById("info").innerHTML = 'Задача: ' + task;
            clearWords(document.getElementById("blockwords"));
            for (let i = 1; i <= countword; i++) {
                random = getRandomInt(0, arr1.length);
                createPanel(arr1[random].trim(), arr2[random], i);
                arr1.splice(random, 1);
                arr2.splice(random, 1);
            }
        }
     
    </script>
    <script> 
        init(); 
        generatewords();
    </script>

</body>
</html>